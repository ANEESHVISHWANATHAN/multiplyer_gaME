     <!DOCTYPE html>
<html lang="en">  
<head>  
<meta charset="UTF-8">  
<title>Tambola</title>  
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">  
<style>  
  body {  
    margin: 0;  
    font-family: "Segoe UI", sans-serif;  
    background: linear-gradient(135deg, #ffecd2, #fcb69f);  
    color: #333;  
    min-height: 100vh;  
    display: flex;  
    flex-direction: column;  
    align-items: center;  
    overflow-x: hidden;  
  }  

  .top-bar {  
    display: flex;  
    overflow-x: auto;  
    padding: 12px 16px;  
    background: #fff;  
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);  
    width: 100%;  
    scrollbar-width: none;  
    z-index: 10;  
    position: sticky;  
    top: 0;  
  }  
  .top-bar::-webkit-scrollbar { display: none; }  
  .player { flex-shrink: 0; margin: 0 12px; text-align: center; cursor: pointer; }  
  .player span { font-size: 14px; display: block; margin-top: 5px; }  

  #achievementText {
    position: fixed;
    top: 70px;
    left: 50%;
    transform: translateX(-50%);
    font-size: clamp(30px, 5vw, 60px);
    font-weight: 900;
    text-align: center;
    color: yellow;
    text-shadow: 0 0 8px #ffff66, 0 0 20px #ffeb3b, 0 0 30px #ffd700;
    pointer-events: none;
    z-index: 9999;
    opacity: 0;
    transition: opacity 0.5s, transform 0.5s;
  }
  #achievementText.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }

  .number-shower {  
    margin: 20px 0;  
    font-size: clamp(22px, 5vw, 42px);  
    font-weight: bold;  
    color: #fff;  
    background: linear-gradient(135deg, #ff416c, #ff4b2b);  
    padding: 16px 38px;  
    border-radius: 20px;  
    box-shadow: 0 6px 20px rgba(0,0,0,0.25);  
    min-width: 120px;  
    text-align: center;  
    letter-spacing: 1px;  
    display: none; /* Hidden until Show Number pressed */
  }  

  .ticket {  
    display: grid;  
    grid-template-columns: repeat(9, 1fr);  
    border-radius: 14px;  
    box-shadow: 0 10px 28px rgba(0,0,0,0.3);  
    background: #fff;  
    width: 94%;  
    margin: 22px auto;  
    overflow: hidden;  
  }  
  .cell {  
    aspect-ratio: 0.85/1;  
    display: flex;  
    align-items: center;  
    justify-content: center;  
    font-weight: 700;  
    font-size: clamp(12px, 1.6vw, 18px);  
    border: 1px solid #ddd;  
    background: linear-gradient(145deg, #fff, #ffe);  
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.3s ease, transform 0.2s;  
  }  
  .cell.correct { background: #28a745; color:#fff; }  
  .cell.wrong { background: #dc3545; color:#fff; }  
  .cell:hover {  
    background: #ffe0d0;  
    transform: scale(1.05);  
  }  

  .btns {  
    display: flex;  
    flex-direction: column;  
    gap: 14px;  
    margin: 18px 0 24px;  
    width: 200px;  
  }  
  .stats-btn {  
    padding: 14px;  
    background: linear-gradient(135deg, #333, #555);  
    color: #fff;  
    font-size: 16px;  
    font-weight: 600;  
    border: none;  
    border-radius: 10px;  
    cursor: pointer;  
    text-align: center;  
    transition: transform 0.2s, box-shadow 0.2s;  
  }  
  .stats-btn:hover {  
    transform: translateY(-2px);  
    box-shadow: 0 4px 14px rgba(0,0,0,0.3);  
  }  

  @media (min-width: 992px) {  
    .ticket { width: 55%; max-width: 650px; }  
    .cell { aspect-ratio: 1.6/1; }  
  }  
</style>  
</head>  
<body>  

<div class="top-bar" id="topBar"></div>  
<div id="achievementText"></div>
<div id="numberShower" class="number-shower">--</div>  

<div class="btns">  
  <button id="startBtn" class="stats-btn" style="display:none;" onclick="startGame()">Start Game</button>
  <button class="stats-btn" onclick="showNumber()">Show Number</button>
</div>  

<div class="ticket" id="ticket"></div>  

<script>  
console.log("ðŸš€ Script loaded");

const ticketEl = document.getElementById("ticket");  
const achievementText = document.getElementById("achievementText");  
const numberShower = document.getElementById("numberShower");  
const topBar = document.getElementById("topBar");  

let players = {}, playerAchievements = {}, markedNumbers = new Set();
let ticketData = [];
let calledNumbers=new Set();

const roomId = localStorage.getItem("roomId");
const playerId = localStorage.getItem("playerId");
const wscode = localStorage.getItem("wscode");
const username = localStorage.getItem("username");
const icon = localStorage.getItem("icon");
const isHost = localStorage.getItem("ishost") === "true";

console.log("Player info:", {roomId, playerId, username, icon, isHost});

if (isHost) document.getElementById("startBtn").style.display="block";

const ws = new WebSocket("wss://multiplyer-game.onrender.com");

ws.onopen = () => {
  console.log("âœ… WS open");
  ws.send(JSON.stringify({typeReq:"pageEntered", roomId, playerId, wscode, isHost}));
};

ws.onmessage = (msg) => {
  console.log("ðŸ“© WS message:", msg.data);
  const data = JSON.parse(msg.data);
  if(data.type==="hejoins"){ players[data.player.playerId]=data.player; renderTopBar(); }
  if(data.type==="heleft"){ delete players[data.playerId]; renderTopBar(); }
  if(data.type==="heachieves"){ showAchievement(`${data.playerName} achieved ${data.achievement}`); updatePlayerArc(data.playerId, data.achievement);}
  if(data.type==="sendTicket"){ ticketData=data.ticket; renderTicket(ticketData);}
  if(data.type==="sendNumber"){ showNumberOverlay(data.number);}
  if(data.type==="gameStarts"){ calledNumbers.clear(); numberShower.style.display="none"; ticketEl.innerHTML="";}
};

function startGame(){
  console.log("Start game clicked");
  if(ws.readyState===WebSocket.OPEN) ws.send(JSON.stringify({typeReq:"startGame", roomId, playerId, wscode}));
}

// TOP BAR
const achievementList=["First Five","First Seven","First Row","Second Row","Third Row","Full House"];
function renderTopBar(){
  console.log("Rendering top bar with players:", players);
  topBar.innerHTML="";
  Object.values(players).forEach(p=>{
    if(!playerAchievements[p.playerId]) playerAchievements[p.playerId]=new Set();
    const div=document.createElement("div");
    div.className="player"; div.id="player-"+p.playerId; div.style.position="relative";

    const r=28,cx=35,cy=35,fullCirc=2*Math.PI*r,arcLen=fullCirc/6;
    const colors=["#ff3c00","#ff9500","#ffea00","#00ff90","#00fff2","#0095ff"];
    const arcs = colors.map((c,i)=>`<circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="${c}" stroke-width="4" stroke-dasharray="${arcLen} ${fullCirc}" stroke-dashoffset="${fullCirc - i*arcLen}" class="arc arc-${i}" style="opacity:0; transition: opacity 0.5s"/>`).join("");
    div.innerHTML=`<svg width="70" height="70" style="transform:rotate(-90deg)"><circle cx="${cx}" cy="${cy}" r="${r}" stroke="#ddd" stroke-width="4" fill="none"/>${arcs}</svg>
    <img src="${p.icon}" style="width:56px;height:56px;border-radius:50%;position:absolute;top:7px;left:7px;"/>
    <span>${p.username}</span>`;
    topBar.appendChild(div);
    playerAchievements[p.playerId].forEach(ach=>{
      const idx=achievementList.indexOf(ach); if(idx>=0){ const arc=div.querySelector(".arc-"+idx); if(arc) arc.style.opacity=1; }
    });
  });
}

function updatePlayerArc(playerId, achievement){
  if(!playerAchievements[playerId]) playerAchievements[playerId]=new Set();
  const idx=achievementList.indexOf(achievement); if(idx===-1) return;
  playerAchievements[playerId].add(achievement);
  const div=document.getElementById("player-"+playerId);
  if(div){ const arc=div.querySelector(".arc-"+idx); if(arc) arc.style.opacity=1; }
}

function showAchievement(text){
  achievementText.textContent=text;
  achievementText.classList.add("show");
  setTimeout(()=>{ achievementText.classList.remove("show"); achievementText.textContent=""; },2000);
}

// TICKET
function renderTicket(ticket){
  ticketEl.innerHTML="";
  ticket.flat().forEach(num=>{
    const cell=document.createElement("div"); cell.classList.add("cell");
    if(num!==null && num!=="") cell.textContent=num;
    cell.onclick=()=>playerMark(cell,num);
    ticketEl.appendChild(cell);
  });
}

function playerMark(cell,num){
  if(calledNumbers.has(num)){
    cell.classList.add("correct");
  }else{
    cell.classList.add("wrong");
    setTimeout(()=>cell.classList.remove("wrong"),2000); // remove red after 2s
  }
}

// NUMBER OVERLAY
function showNumber(){
  numberShower.style.display="block";
  numberShower.textContent="--";
}
function showNumberOverlay(num){
  numberShower.style.display="block";
  numberShower.textContent=num;
  autoMark(num);
  calledNumbers.add(num);
}

function autoMark(num){
  document.querySelectorAll("#ticket .cell").forEach(cell=>{
    if(parseInt(cell.textContent)===num){
      cell.classList.add("correct");
    }
  });
}
</script>  
</body>  
</html>
