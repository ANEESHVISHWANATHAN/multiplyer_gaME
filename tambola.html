<!DOCTYPE html>
<html lang="en">  
<head>  
  <meta charset="UTF-8">  
  <title>Tambola</title>  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">  
  <style>  
    body {  
      margin: 0;  
      font-family: "Segoe UI", sans-serif;  
      background: linear-gradient(135deg, #ffecd2, #fcb69f);  
      color: #333;  
      min-height: 100vh;  
      display: flex;  
      flex-direction: column;  
      align-items: center;  
      overflow-x: hidden;  
    }  

    .top-bar {  
      display: flex;  
      overflow-x: auto;  
      padding: 12px 16px;  
      background: #fff;  
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);  
      width: 100%;  
      scrollbar-width: none;  
    }  
    .top-bar::-webkit-scrollbar { display: none; }  
    .player { flex-shrink: 0; margin: 0 12px; text-align: center; }  
    .player img { width: 56px; height: 56px; border-radius: 50%; border: 2px solid #ccc; object-fit: cover; }  
    .player span { font-size: 14px; display: block; margin-top: 5px; }  

    .number-shower {  
      margin: 20px 0;  
      font-size: clamp(22px, 5vw, 42px);  
      font-weight: bold;  
      color: #fff;  
      background: linear-gradient(135deg, #ff416c, #ff4b2b);  
      padding: 16px 38px;  
      border-radius: 20px;  
      box-shadow: 0 6px 20px rgba(0,0,0,0.25);  
      min-width: 120px;  
      text-align: center;  
      letter-spacing: 1px;  
    }  

    .ticket {  
      display: grid;  
      grid-template-columns: repeat(9, 1fr);  
      border: 4px solid #ff4b2b;  
      border-radius: 14px;  
      box-shadow: 0 10px 28px rgba(0,0,0,0.3);  
      background: #fff8f0;  
      width: 94%;  
      margin: 22px auto;  
      overflow: hidden;  
    }  
    .cell {  
      aspect-ratio: 0.85/1;  
      display: flex;  
      align-items: center;  
      justify-content: center;  
      font-weight: 700;  
      font-size: clamp(12px, 1.6vw, 18px);  
      border: 1px solid #ddd;  
      background: #fff;  
      transition: background 0.3s ease, transform 0.2s;  
    }  
    .cell:hover {  
      background: #ffe0d0;  
      transform: scale(1.05);  
    }  
    .highlight {   
      background: #ffcc80 !important;   
      font-weight: 800;   
      color: #222;  
    }  

    .btns {  
      display: flex;  
      flex-direction: column;  
      gap: 14px;  
      margin: 18px 0 24px;  
      width: 200px;  
    }  
    .stats-btn {  
      padding: 14px;  
      background: linear-gradient(135deg, #333, #555);  
      color: #fff;  
      font-size: 16px;  
      font-weight: 600;  
      border: none;  
      border-radius: 10px;  
      cursor: pointer;  
      text-align: center;  
      transition: transform 0.2s, box-shadow 0.2s;  
    }  
    .stats-btn:hover {  
      transform: translateY(-2px);  
      box-shadow: 0 4px 14px rgba(0,0,0,0.3);  
    }  

    .overlay {  
      position: fixed;  
      top: 0; left: 0;  
      width: 100%; height: 100%;  
      display: flex;  
      justify-content: center;  
      align-items: center;  
      z-index: 1000;  
      backdrop-filter: blur(8px);  
      visibility: hidden;  
    }  

    .overlay-box {  
      position: relative;  
      width: 90%;  
      max-width: 900px;  
      max-height: 75%;  
      margin: 15% auto;  
      border: 14px solid #ff2d55;  
      border-radius: 20px;  
      background: rgba(15, 15, 30, 0.95);  
      box-shadow: 0 0 20px rgba(255, 45, 85, 0.6),  
                  inset 0 0 12px rgba(255,255,255,0.1);  
      overflow-y: auto;  
      padding: 30px 20px;  
      transform: translateY(100%);  
      transition: transform 0.5s ease-in-out;  
    }  

    .overlay.active { visibility: visible; }  
    .overlay.active .overlay-box { transform: translateY(0); }  

    .close-btn {  
      position: absolute;  
      font-size: 20px;  
      color: #ff2d55;  
      background: #fff;  
      border-radius: 50%;  
      width: 32px; height: 32px;  
      display: flex;  
      align-items: center;  
      justify-content: center;  
      cursor: pointer;  
      box-shadow: 0 2px 6px rgba(0,0,0,0.4);  
      z-index: 1101;  
    }  
    @media (orientation: landscape) {  
      .close-btn { top: 10px; right: 10px; }  
    }  
    @media (orientation: portrait) {  
      .close-btn { top: 10px; left: 50%; transform: translateX(-50%); }  
    }  

    .lb-row {  
      display: flex;  
      align-items: center;  
      justify-content: space-between;  
      padding: 12px;  
      font-size: 16px;  
      font-weight: bold;  
      color: #fff;  
      background: linear-gradient(90deg, rgba(255,255,255,0.1), rgba(255,45,85,0.3));  
      border-radius: 10px;  
      margin-bottom: 10px;  
      box-shadow: 0 2px 6px rgba(0,0,0,0.4);  
    }  
    .lb-info { display: flex; align-items: center; gap: 10px; }  
    .lb-info img {  
      width: 38px; height: 38px;  
      border-radius: 50%;  
      border: 2px solid #fff;  
    }  

    .numbers-grid { display: grid; gap: 6px; justify-items: center; }  
    .num-cell {  
      width: 34px; height: 34px;  
      display: flex; align-items: center; justify-content: center;  
      border-radius: 6px;  
      font-size: 14px;  
      font-weight: bold;  
      color: #fff;  
      background: #b22222;  
    }  
    .num-cell.called { background: #228b22; }  

    @media (min-width: 992px) {  
      .ticket { width: 55%; max-width: 650px; }  
      .cell { aspect-ratio: 1.6/1; }  
      .overlay-box { margin: 15% auto; width: 70%; }  
      .numbers-grid { grid-template-columns: repeat(10, 1fr); }  
      .num-cell { width: 40px; height: 40px; font-size: 15px; }  
    }  

    @media (max-width: 576px) and (orientation: portrait) {  
      .ticket { width: 96%; }  
      .cell { aspect-ratio: 0.7/1; }  
      .overlay-box { margin: 10% auto; width: 90%; }  
      .numbers-grid { grid-template-columns: repeat(8, 1fr); }  
      .num-cell { width: 32px; height: 32px; font-size: 13px; }  
    }  

    @media (max-width: 992px) and (orientation: landscape) {  
      .ticket { width: 80%; }  
      .cell { aspect-ratio: 1.4/1; }  
      .overlay-box { margin: 10% auto; width: 75%; max-height: 65%; }  
      .numbers-grid { grid-template-columns: repeat(10, 1fr); }  
    }  
  </style>  
</head>  
<body>  
  <div class="top-bar" id="topBar"></div>  

  <div id="numberShower" class="number-shower">--</div>  

  <div class="ticket" id="ticket"></div>  

  <div class="btns">  
    <button class="stats-btn" onclick="openLeaderboard()">Leaderboard</button>  
    <button class="stats-btn" onclick="openNumbers()">Numbers</button>  
  </div>  

  <div class="overlay" id="leaderboard">  
    <span class="close-btn" onclick="closeLeaderboard()">❌</span>  
    <div class="overlay-box">  
      <div id="lb-rows"></div>  
    </div>  
  </div>  

  <div class="overlay" id="numbersChart">  
    <span class="close-btn" onclick="closeNumbers()">❌</span>  
    <div class="overlay-box">  
      <div class="numbers-grid" id="numbersGrid"></div>  
    </div>  
  </div>  

  <script>  
    /* ---------------- Ticket setup ---------------- */  
    const ticketEl = document.getElementById("ticket");  
    const numbers = [  
      [1,"",12,"",35,"",67,"",89],  
      ["",10,"",23,"",56,"",70,""],  
      [5,"","",27,"",48,"",74,90]  
    ];  
    numbers.flat().forEach(num => {  
      const cell = document.createElement("div");  
      cell.classList.add("cell");  
      if(num!=="") cell.textContent=num;  
      ticketEl.appendChild(cell);  
    });  

    /* ---------------- Number caller ---------------- */  
    const numberShower=document.getElementById("numberShower");  
    let calledNumbers = new Set();  
    function showLotteryNumber(finalNum){  
      let count=0;  
      const spin=setInterval(()=>{  
        numberShower.textContent=Math.floor(Math.random()*90)+1;  
        if(++count>15){  
          clearInterval(spin);  
          numberShower.textContent=finalNum;  
          calledNumbers.add(finalNum);  
          updateNumbersGrid();  
        }  
      },100);  
    }  
    setInterval(()=>showLotteryNumber(Math.floor(Math.random()*90)+1),4000);  

    /* ---------------- Leaderboard ---------------- */  
    let playersLocal = [  
      {name:"Alice", score:45, icon:"https://via.placeholder.com/32"},  
      {name:"Bob", score:39, icon:"https://via.placeholder.com/32"},  
      {name:"Charlie", score:28, icon:"https://via.placeholder.com/32"}  
    ];  

    function renderLeaderboard(){  
      playersLocal.sort((a,b)=>b.score-a.score);  
      const lb=document.getElementById("lb-rows");  
      lb.innerHTML="";  
      playersLocal.forEach(p=>{  
        const row=document.createElement("div");  
        row.className="lb-row";  
        row.innerHTML=`  
          <div class="lb-info">  
            <img src="${p.icon}">  
            <span>${p.name}</span>  
          </div>  
          <span>${p.score}</span>  
        `;  
        lb.appendChild(row);  
      });  
    }  

    function openLeaderboard(){  
      renderLeaderboard();  
      document.getElementById("leaderboard").classList.add("active");  
    }  
    function closeLeaderboard(){  
      document.getElementById("leaderboard").classList.remove("active");  
    }  

    /* ---------------- Numbers chart ---------------- */  
    function createNumbersGrid(){  
      const grid=document.getElementById("numbersGrid");  
      for(let i=1;i<=90;i++){  
        const div=document.createElement("div");  
        div.className="num-cell";  
        div.textContent=i;  
        grid.appendChild(div);  
      }  
    }  
    function updateNumbersGrid(){  
      document.querySelectorAll(".num-cell").forEach(cell=>{  
        const val=parseInt(cell.textContent);  
        if(calledNumbers.has(val)) cell.classList.add("called");  
      });  
    }  
    createNumbersGrid();  

    function openNumbers(){  
      updateNumbersGrid();  
      document.getElementById("numbersChart").classList.add("active");  
    }  
    function closeNumbers(){  
      document.getElementById("numbersChart").classList.remove("active");  
    }  

    /* ---------------- Multiplayer top bar ---------------- */  
    const topBar=document.getElementById("topBar");  
    let players={};  

    function renderTopBar(){  
      topBar.innerHTML="";  
      Object.values(players).forEach(p=>{  
        const div=document.createElement("div");  
        div.className="player";  
        div.innerHTML=`<img src="${p.icon}"><span>${p.username}</span>`;  
        topBar.appendChild(div);  
      });  
    }  

    // LocalStorage values from previous page  
    const roomId=localStorage.getItem("roomId");  
    const playerId=localStorage.getItem("playerId");  
    const wscode=localStorage.getItem("wscode");  
    const username=localStorage.getItem("username");  
    const icon=localStorage.getItem("icon");  
    const isHost=localStorage.getItem("isHost")==="true";  
    const gameType=localStorage.getItem("gameType") || "public";  

    const ws=new WebSocket("wss://multiplyer-game.onrender.com");  

    ws.onopen = () => {
      console.log("✅ Connected to WS");
      ws.send(JSON.stringify({
        typeReq: "pageEntered",
        roomId,
        playerId,
        wscode,
        isHost,
        gameType
      }));
    };

    ws.onmessage=(msg)=>{  
      const data=JSON.parse(msg.data);  
      console.log("📩", data);  

      if(data.type==="ijoin"){  
        data.players.forEach(p=>{ players[p.playerId]=p; });  
        renderTopBar();  
      }  

      if(data.type==="hejoins"){  
        players[data.player.playerId]=data.player;  
        renderTopBar();  
      }  
    };  
  </script>  
</body>  
</html>
  
