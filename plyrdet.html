<!DOCTYPE html>
<html>
<head>
    <title>Join Lobby</title>
</head>
<body>
    <h1>Enter Your Details</h1>
    <label>Username:</label> 
    <input type="text" id="username"><br>
    <label>Choose Icon:</label> 
    <input type="file" id="icon" accept="image/*"><br>
    <label>Enter Room Code:</label> 
    <input type="text" id="roomID" maxlength="5"><br>
    <button onclick="joinLobby()">Submit</button>

    <script>
const socket = new WebSocket('wss://multiplyer-game.onrender.com'); // <-- GLOBAL

socket.onmessage = (event) => {
    const message = JSON.parse(event.data);
    if (message.type === "lobbyJoined") {
        localStorage.setItem("roomID", localStorage.getItem("tempRoomID")); // Save permanently
        window.location.href = `lobby.html?roomID=${localStorage.getItem("roomID")}`;
    } else if(message.type === "notActive") {
        alert("Room not active");
    } else if(message.type === "hostNot") {
        alert("Host not present");
    }
};

function joinLobby() {
    const username = document.getElementById("username").value;
    const iconFile = document.getElementById("icon").files[0];
    const roomID = document.getElementById("roomID").value;

    if (username && iconFile && roomID) {
        const reader = new FileReader();
        reader.onload = () => {
            localStorage.setItem("username", username);
            localStorage.setItem("icon", reader.result);
            localStorage.setItem("host", false);
            localStorage.setItem("tempRoomID", roomID);

            if (socket.readyState === WebSocket.OPEN) {
                socket.send(JSON.stringify({ type: "joinLobby", roomID, username, icon: reader.result }));
            } else {
                socket.onopen = () => {
                    socket.send(JSON.stringify({ type: "joinLobby", roomID, username, icon: reader.result }));
                };
            }
        };
        reader.readAsDataURL(iconFile);
    }
}
</script>

</body>
</html>
