<!DOCTYPE html>
<html>
<head>
  <title>BINGO LOBBY PAGE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background: #f5f5f5;
      font-family: sans-serif;
      margin: 0;
      padding: 0;
    }
    .card {
      background-color: #333;
      border: 2px solid #ff6666;
      border-radius: 16px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      color: #fff;
      width: 150px;
      height: 140px;
      display: none;
      position: absolute;
      transition: transform 0.3s;
    }
    .card:hover {
      transform: scale(1.05);
      border-color: yellow;
    }
    .icon {
      border-radius: 50%;
      position: absolute;
      top: 20px;
      left: 40px;
      height: 50px;
      width: 70px;
      object-fit: cover;
    }
    .label {
      position: absolute;
      top: 90px;
      left: 25px;
      width: 100px;
      background: none;
      border: none;
      color: #fff;
      text-align: center;
      font-weight: bold;
      font-size: 16px;
    }
    .bottom {
      position: fixed;
      bottom: 0;
      width: 100%;
      height: 120px;
      background-color: #222;
      border-top: 3px solid yellow;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 100px;
    }
    .btn {
      padding: 20px 40px;
      font-size: 28px;
      border-radius: 16px;
      border: 3px solid green;
      background-color: #fff;
      color: #000;
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn:hover {
      border-color: red;
      color: red;
      background-color: #eee;
    }
    @media only screen and (max-width: 768px) {
      .card {
        width: 100px;
        height: 100px;
      }
      .icon {
        height: 40px;
        width: 60px;
        top: 15px;
        left: 20px;
      }
      .label {
        top: 70px;
        left: 15px;
        font-size: 12px;
        width: 70px;
      }
      .btn {
        padding: 10px 20px;
        font-size: 18px;
      }
    }
  </style>
</head>
<body>
  <div id="player-container">
    <form name="f1">
      <!-- 8 player cards -->
      <script>
        for (let i = 1; i <= 8; i++) {
          document.write(`
            <div id="pl${i}" class="card" style="top: ${i <= 4 ? 120 : 300}px; left: ${250 + ((i - 1) % 4) * 200}px;">
              <input type="text" value="player" id="u${i}" class="label" disabled>
              <img src="exit.png" id="i${i}" class="icon">
            </div>
          `);
        }
      </script>
    </form>
  </div>

  <!-- Host Buttons -->
  <div id="bott-bar" class="bottom" style="display: none;">
    <input type="button" value="START" class="btn" onclick="startGame()">
    <input type="button" value="DELETE" class="btn" onclick="deleteLobby()">
  </div>

  <script>
    const ws = new WebSocket("wss://multiplyer-game.onrender.com");

    const username = localStorage.getItem('username');
    const icon = localStorage.getItem('icon');
    const playerID = parseInt(localStorage.getItem('playerID'));
    const wscode = localStorage.getItem('wscode');
    const roomID = localStorage.getItem('roomID');
    const isHost = localStorage.getItem('host') === "true";

    console.log("Lobby Loaded:", { username, icon, playerID, wscode, roomID, isHost });

    window.onload = () => {
      // Update UI
      const nameField = document.getElementById(`u${playerID + 1}`);
      const iconField = document.getElementById(`i${playerID + 1}`);
      const card = document.getElementById(`pl${playerID + 1}`);

      if (nameField && iconField && card) {
        nameField.value = username;
        iconField.src = icon;
        card.style.display = "block";
      }

      // Show host controls
      if (isHost) {
        document.getElementById("bott-bar").style.display = "flex";
      }

      // Notify server
      ws.onopen = () => {
        console.log("WebSocket connected. Sending lobbyEntered...");
        ws.send(JSON.stringify({
          type: "lobbyEntered",
          username,
          icon,
          wscode,
          roomID,
          playerID
        }));
      };

      ws.onmessage = (msg) => {
        const data = JSON.parse(msg.data);
        console.log("Server Message:", data);

        if (data.type === "updatePlayerCard") {
          const { playerID, username, icon } = data;
          const u = document.getElementById(`u${playerID + 1}`);
          const i = document.getElementById(`i${playerID + 1}`);
          const p = document.getElementById(`pl${playerID + 1}`);
          if (u && i && p) {
            u.value = username;
            i.src = icon;
            p.style.display = "block";
          }
        }

        if (data.type === "hostConfirmed") {
          console.log("Host confirmed by server.");
        }

        if (data.type === "error") {
          alert(data.message || "Something went wrong.");
        }
      };
    };

    function startGame() {
      console.log("Start game requested by host.");
      ws.send(JSON.stringify({ type: "startGame", roomID }));
    }

    function deleteLobby() {
      console.log("Host requested to delete lobby.");
      ws.send(JSON.stringify({ type: "deleteLobby", roomID }));
    }
  </script>
</body>
</html>
