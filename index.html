<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>FUNTAMBOLA Entry</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet">
<style>
/* --- styles unchanged from your code --- */
* {margin:0; padding:0; box-sizing:border-box;}
body {width:100%; min-height:100vh; font-family:'Orbitron', sans-serif;
  background:linear-gradient(135deg,#0b0033,#26004d,#000);
  color:white; overflow-x:hidden; position:relative;}
.bg-image {position:absolute; pointer-events:none; user-select:none; opacity:0.12; z-index:-1;}
.bg1 {top:2%; left:2%; width:35%; transform:rotate(-5deg);}
.bg2 {top:10%; right:0; width:25%; transform:rotate(3deg);}
.bg3 {top:20%; left:25%; width:40%; transform:rotate(-8deg);}
.bg4 {bottom:10%; left:5%; width:30%; transform:rotate(5deg);}
.bg5 {bottom:20%; right:10%; width:35%; transform:rotate(-2deg);}
.bg6 {bottom:5%; left:40%; width:30%; transform:rotate(10deg);}
.bg7 {top:35%; right:20%; width:25%; transform:rotate(-12deg);}
.bg8 {top:50%; left:10%; width:30%; transform:rotate(7deg);}
.heading {margin-top:20px;text-align:center;font-size:clamp(24px,6vw,48px);font-weight:bold;color:#00f2fe;
  text-shadow:0 0 8px #00f2fe,0 0 16px #0072ff,0 0 30px #0072ff; z-index:1;}
.description {margin:20px auto;max-width:600px;text-align:center;padding:0 15px;
  font-size:clamp(14px,3vw,20px);line-height:1.5;color:#ddd;text-shadow:0 0 6px rgba(0,0,0,0.6);z-index:1;}
.center {margin:30px auto;width:90%;max-width:500px;text-align:center;z-index:1;}
.btn {width:100%; padding:16px; margin:14px 0; font-size:clamp(18px,5vw,28px);
  border:none; border-radius:16px; color:#fff; cursor:pointer;
  transition:transform 0.25s, box-shadow 0.25s; letter-spacing:1px;}
.btn:hover {transform:scale(1.05); box-shadow:0 0 20px rgba(255,255,255,0.5);}
#joinBtn {background:linear-gradient(90deg,#36d1dc,#5b86e5); box-shadow:0 0 15px rgba(91,134,229,0.7);}
#createBtn {background:linear-gradient(90deg,#ff512f,#dd2476); box-shadow:0 0 15px rgba(221,36,118,0.7); transition:margin-top 0.4s;}
#joinPanel {width:100%; margin-top:12px; background:rgba(0,0,0,0.6); border:2px solid #00f2fe;
  border-radius:18px; box-shadow:0 0 25px #00f2fe; backdrop-filter:blur(8px);
  max-height:0; overflow:hidden; opacity:0; transition:all 0.4s ease;}
#joinPanel.active {max-height:400px; opacity:1; padding:12px;}
.toggle-container {display:flex; position:relative; margin-bottom:10px; border-radius:12px; overflow:hidden;
  background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.15); cursor:pointer;}
.toggle-segment {flex:1; padding:10px; text-align:center; font-size:clamp(14px,4vw,20px); z-index:2;}
.toggle-slider {position:absolute; top:0; left:0; width:50%; height:100%; background:linear-gradient(90deg,#00f2fe,#4facfe);
  border-radius:12px; z-index:1; transition:left 0.3s;}
.toggle-on .toggle-slider {left:50%; background:linear-gradient(90deg,#ff4b2b,#ff416c);}
#publicLobbies {max-height:200px; overflow-y:auto; margin-bottom:10px;}
.lobby-row {display:flex; justify-content:space-between; align-items:center; padding:10px; margin:6px 0;
  border-radius:10px; background:rgba(255,255,255,0.1); font-size:clamp(14px,4vw,18px); border:2px solid #00f2fe;
  box-shadow:0 4px 8px rgba(0,242,254,0.6);}
.lobby-row img {width:28px; cursor:pointer;}
#privateJoin {display:none;}
#roomInput {width:100%; padding:10px; border-radius:10px; border:none; outline:none; font-size:clamp(14px,4vw,18px);
  background:rgba(255,255,255,0.12); color:white; margin-bottom:8px; box-shadow:0 4px 6px rgba(255,255,255,0.3);}
#privateJoinBtn {width:100%; padding:10px; border-radius:10px; border:none; font-size:clamp(14px,4vw,18px); font-weight:bold;
  background:linear-gradient(90deg,#ff4b2b,#ff416c); color:white; cursor:pointer; box-shadow:0 4px 8px rgba(255,75,75,0.5);}
#avatarPopup {position:fixed; top:0; left:0; width:100%; height:100%; backdrop-filter:blur(10px); background:rgba(0,0,0,0.6);
  display:none; justify-content:center; align-items:center; z-index:999;}
#avatarContent {position:relative; background:rgba(20,20,40,0.95); border-radius:20px; padding:20px; text-align:center;
  max-width:400px; width:90%; box-shadow:0 0 25px #00f2fe;}
#avatarClose {position:absolute; top:10px; right:15px; font-size:24px; color:#ff416c; cursor:pointer;}
#avatarContent h2 {margin-bottom:12px; color:#00f2fe;}
#carousel {display:flex; align-items:center; justify-content:center; gap:12px;}
#carousel img {width:100px; border-radius:50%; border:2px solid #fff;}
#carousel button {background:transparent; border:none; color:#00f2fe; font-size:28px; cursor:pointer;}
#username {width:100%; padding:10px; margin:12px 0; border-radius:10px; border:none; outline:none;}
#startGame {padding:10px 20px; border:none; border-radius:12px; background:linear-gradient(90deg,#36d1dc,#5b86e5);
  color:white; font-weight:bold; cursor:pointer; box-shadow:0 0 15px rgba(91,134,229,0.7);}
@media (orientation: landscape) {.heading{font-size:clamp(20px,4vw,32px);} .center{margin-top:50px;}
  .btn{padding:12px; margin:10px 0; font-size:18px;}}
</style>
</head>
<body>
<div class="heading">FUNTAMBOLA</div>
<div class="description">Welcome to FUNTAMBOLA – the exciting online version of the classic Tambola game!  
Join a public room or create your own private match with friends.  
Pick your avatar, enter your lucky name, and get ready for fun, numbers, and thrilling wins!</div>

<!-- Background images -->
<img src="tam1.png" class="bg-image bg1"><img src="tam2.png" class="bg-image bg2"><img src="tam3.png" class="bg-image bg3">
<img src="tam4.png" class="bg-image bg4"><img src="tam5.png" class="bg-image bg5"><img src="tam6.png" class="bg-image bg6">
<img src="tam7.png" class="bg-image bg7"><img src="tam8.png" class="bg-image bg8">

<div class="center">
  <button id="joinBtn" class="btn">JOIN</button>
  <div id="joinPanel">
    <div id="toggleBar" class="toggle-container">
      <div class="toggle-slider"></div>
      <div class="toggle-segment">Public</div>
      <div class="toggle-segment">Private</div>
    </div>
    <div id="publicLobbies"></div>
    <div id="privateJoin">
      <input id="roomInput" type="text" maxlength="5" placeholder="Enter Room ID">
      <button id="privateJoinBtn">JOIN ➤</button>
    </div>
  </div>
  <button id="createBtn" class="btn">CREATE</button>
</div>

<!-- Avatar Popup -->
<div id="avatarPopup">
  <div id="avatarContent">
    <span id="avatarClose">❌</span>
    <h2>Select Avatar & Name</h2>
    <div id="carousel">
      <button id="prev">&#60;</button>
      <img id="avatarImg" src="avt1.jpg">
      <button id="next">&#62;</button>
    </div>
    <input id="username" type="text" placeholder="Enter Username">
    <button id="startGame">Start</button>
  </div>
</div>

<script>
const ws = new WebSocket("wss://my-4a9r.onrender.com");
ws.onopen = () => console.log("WS connected");
ws.onmessage = (msg) => {
  console.log("WS message:", msg.data);
  try {
    const data = JSON.parse(msg.data);
    if(data.action === "lobbyCreated"){
      console.log("Lobby Created:", data);
      window.location.href = `https://my-4a9r.onrender.com/${data.roomId}`;
    }
    if(data.action === "lobbyJoined"){
      console.log("Lobby Joined:", data);
      window.location.href = `https://my-4a9r.onrender.com/${data.roomId}`;
    }
  } catch(e){ console.error("WS parse error", e); }
};

const joinBtn = document.getElementById("joinBtn");
const joinPanel = document.getElementById("joinPanel");
const createBtn = document.getElementById("createBtn");
const toggleBar = document.getElementById("toggleBar");
const publicLobbies = document.getElementById("publicLobbies");
const privateJoin = document.getElementById("privateJoin");
const avatarPopup = document.getElementById("avatarPopup");
const avatarClose = document.getElementById("avatarClose");
const avatarImg = document.getElementById("avatarImg");
const prevBtn = document.getElementById("prev");
const nextBtn = document.getElementById("next");
const startBtn = document.getElementById("startGame");
let avatarIndex = 0;
const avatars = ["avt1.jpg","avt2.jpg","avt3.jpg","avt4.jpg","avt5.jpg","avt6.jpg","avt7.jpg","avt8.jpg"];
let isPrivate = false;
let actionType = null; 
let selectedRoomId = null;

// Join panel toggle
joinBtn.onclick = () => {
  joinPanel.classList.toggle("active");
  createBtn.style.marginTop = joinPanel.classList.contains("active") ? "16px" : "0";
};

// Toggle pub/pri
toggleBar.onclick = () => {
  isPrivate = !isPrivate;
  toggleBar.classList.toggle("toggle-on", isPrivate);
  publicLobbies.style.display = isPrivate ? "none" : "block";
  privateJoin.style.display = isPrivate ? "block" : "none";
};

// Demo lobbies
for(let i=1;i<=5;i++){
  const row = document.createElement("div");
  row.className="lobby-row";
  row.innerHTML=`<div>Lobby ${i}</div><div>ID${100+i}</div><div>${i}/8</div><img src="join.png" class="lobbyJoin">`;
  publicLobbies.appendChild(row);
  row.querySelector(".lobbyJoin").onclick = () => {
    actionType = "join";
    selectedRoomId = `ID${100+i}`;
    console.log("Joining public lobby:", selectedRoomId);
    showAvatarPopup();
  };
}

// Avatar popup
function showAvatarPopup(){
  avatarPopup.style.display="flex"; 
  avatarIndex=0; 
  avatarImg.src=avatars[avatarIndex];
}
createBtn.onclick = () => {actionType="create"; showAvatarPopup();}
document.getElementById("privateJoinBtn").onclick = () => {
  actionType="join";
  selectedRoomId=document.getElementById("roomInput").value.trim();
  console.log("Joining private lobby:", selectedRoomId);
  showAvatarPopup();
};
avatarClose.onclick = () => { avatarPopup.style.display="none"; }

// Carousel
prevBtn.onclick = () => { avatarIndex=(avatarIndex-1+avatars.length)%avatars.length; avatarImg.src=avatars[avatarIndex]; }
nextBtn.onclick = () => { avatarIndex=(avatarIndex+1)%avatars.length; avatarImg.src=avatars[avatarIndex]; }

// Start
startBtn.onclick = () => {
  const uname = document.getElementById("username").value.trim();
  if(!uname){ alert("Enter username"); return; }
  const payload = {username:uname, icon:avatars[avatarIndex], type:isPrivate?"pri":"pub"};
  if(actionType==="create"){
    ws.send(JSON.stringify({action:"createLobby", ...payload}));
    console.log("Sent createLobby:", payload);
  } else if(actionType==="join"){
    ws.send(JSON.stringify({action:"joinLobby", ...payload, roomId:selectedRoomId}));
    console.log("Sent joinLobby:", payload, "roomId:", selectedRoomId);
  }
  avatarPopup.style.display="none";
};
</script>
</body>
</html>
